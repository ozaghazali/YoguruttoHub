return function(loaderGuiToDestroy)
	--========================--
	-- [PEMBERSIHAN] OTOMATIS --
	--========================--
	if _G.YoguruttoTeleportScriptHandle and typeof(_G.YoguruttoTeleportScriptHandle.cleanup) == "function" then
		_G.YoguruttoTeleportScriptHandle:cleanup()
	end

	--================--
	--   SERVICES     --
	--================--
	local Players = game:GetService("Players")
	local UserInputService = game:GetService("UserInputService")
	local RunService = game:GetService("RunService")
	local ContextActionService = game:GetService("ContextActionService")
	local StarterGui = game:GetService("StarterGui")
	local Workspace = game:GetService("Workspace")

	--================--
	--  CONFIGURATION --
	--================--
	local player = Players.LocalPlayer
	
	-- [MODIFIKASI] Konstanta untuk Walkspeed dan JumpPower
	local MIN_WALKSPEED = 1
	local MAX_WALKSPEED = 100
	local DEFAULT_WALKSPEED = 16
	
	local MIN_JUMPPOWER = 1
	local MAX_JUMPPOWER = 100
	local DEFAULT_JUMPPOWER = 50 -- Standar Roblox

	-- [MODIFIKASI] Konstanta untuk Gravity
	local MIN_GRAVITY = 1
	local MAX_GRAVITY = 500
	local DEFAULT_GRAVITY = 196.2 -- Standar Roblox

	-- [MODIFIKASI ESP] Konfigurasi ESP
	local ESP_FRIEND_COLOR = Color3.fromRGB(0, 0, 255)
	local ESP_ENEMY_COLOR = Color3.fromRGB(255, 0, 0) 
	local ESP_USE_TEAM_COLOR = true

	--================--
	--      STATE     --
	--================--
	
	local freecamEnabled = false
	local connections = {}
	
	local currentWalkSpeed = DEFAULT_WALKSPEED
	local isDraggingWalkspeedSlider = false
	local currentJumpPower = DEFAULT_JUMPPOWER
	local isDraggingJumpSlider = false
	
	-- [MODIFIKASI] State untuk Gravity
	local currentGravity = DEFAULT_GRAVITY
	local isDraggingGravitySlider = false

	local isSpectating = false
	local spectateTarget = nil
	local spectateCharacterAddedConn = nil

	-- [MODIFIKASI ESP] State ESP
	local espEnabled = false
	local espConnection = nil

	-- [MODIFIKASI FLY] State untuk Fly
	local flyEnabled = false
	local flyKeyDown, flyKeyUp
	local flyControl = {F = 0, B = 0, L = 0, R = 0, Q = 0, E = 0}
	local fly_lControl = {F = 0, B = 0, L = 0, R = 0, Q = 0, E = 0}
	local flySpeed = 1 -- Kecepatan dasar dari W/A/S/D
	local flyBaseSpeed = 50 -- Pengali kecepatan

	--================--
	--   FUNCTIONS    --
	--================--
	
	local stopSpectating
	local stopFly -- Deklarasi awal untuk stopFly
	local toggleFreecam -- Deklarasi awal untuk toggleFreecam
	local toggleFly -- Deklarasi awal untuk toggleFly
	
	local function teleportCharacter(character, position)
		if character and character:FindFirstChild("HumanoidRootPart") then
			character.HumanoidRootPart.CFrame = CFrame.new(position)
		end
	end

	stopSpectating = function()
		if not isSpectating then return end 
		
		isSpectating = false
		spectateTarget = nil
		
		if spectateCharacterAddedConn then
			spectateCharacterAddedConn:Disconnect()
			spectateCharacterAddedConn = nil
		end
		
		if Workspace.CurrentCamera then
			Workspace.CurrentCamera.CameraType = Enum.CameraType.Custom 
			local localHumanoid = player.Character and player.Character:FindFirstChildOfClass("Humanoid")
			Workspace.CurrentCamera.CameraSubject = localHumanoid
		end
	end

	local function startSpectating(targetPlayer)
		if freecamEnabled then
			FreecamModule.ToggleFreecam()
			freecamEnabled = false
			MainFrame.Visible = true
		end

		stopSpectating()
		stopFly() -- [MODIFIKASI FLY] Matikan fly jika spectate

		isSpectating = true
		spectateTarget = targetPlayer
		
		local camera = Workspace.CurrentCamera
		camera.CameraType = Enum.CameraType.Custom 

		local function setSubject(character)
			if not character or not character.Parent then return end
			local humanoid = character:WaitForChild("Humanoid")
			
			if humanoid and isSpectating and spectateTarget == targetPlayer then
				camera.CameraSubject = humanoid
			end
		end

		setSubject(targetPlayer.Character)
		
		spectateCharacterAddedConn = targetPlayer.CharacterAdded:Connect(setSubject)
		
		table.insert(connections, spectateCharacterAddedConn)
	end

	-- [MODIFIKASI ESP] Holder & Template untuk Nama dan Jarak
	local espHolder = Instance.new("Folder", game:GetService("CoreGui")) --
	espHolder.Name = "Yogurutto_ESP_Holder"
	
	local espNameTagTemplate = Instance.new("BillboardGui") --
	espNameTagTemplate.Name = "ESP_NameTag"
	espNameTagTemplate.Enabled = true
	espNameTagTemplate.Size = UDim2.new(0, 200, 0, 60) -- [MODIFIKASI] Tinggi ditambah untuk jarak
	espNameTagTemplate.AlwaysOnTop = true --
	espNameTagTemplate.StudsOffset = Vector3.new(0, 3, 0) -- [MODIFIKASI] Dinaikkan sedikit
	
	-- [MODIFIKASI] Layout untuk menyusun Nama dan Jarak
	local espListLayout = Instance.new("UIListLayout", espNameTagTemplate)
	espListLayout.FillDirection = Enum.FillDirection.Vertical
	espListLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	espListLayout.SortOrder = Enum.SortOrder.LayoutOrder

	-- [MODIFIKASI] Label baru untuk Jarak
	local espDistanceLabel = Instance.new("TextLabel", espNameTagTemplate)
	espDistanceLabel.Name = "Distance"
	espDistanceLabel.BackgroundTransparency = 1
	espDistanceLabel.Size = UDim2.new(1, 0, 0, 20)
	espDistanceLabel.TextSize = 16
	espDistanceLabel.TextColor3 = Color3.new(1, 1, 1)
	espDistanceLabel.TextStrokeColor3 = Color3.new(0, 0, 0)
	espDistanceLabel.TextStrokeTransparency = 0.2
	espDistanceLabel.Text = " 0 m "
	espDistanceLabel.Font = Enum.Font.SourceSans

	local espTagLabel = Instance.new("TextLabel", espNameTagTemplate) --
	espTagLabel.Name = "Tag"
	espTagLabel.BackgroundTransparency = 1 --
	espTagLabel.Size = UDim2.new(1, 0, 0, 20) -- [MODIFIKASI] Ukuran disesuaikan
	espTagLabel.TextSize = 16 --
	espTagLabel.TextColor3 = Color3.new(1, 1, 1) --
	espTagLabel.TextStrokeColor3 = Color3.new(0, 0, 0) --
	espTagLabel.TextStrokeTransparency = 0.4 --
	espTagLabel.Text = "PlayerName"
	espTagLabel.Font = Enum.Font.SourceSansBold --
	
	-- [MODIFIKASI ESP] Fungsi Inti ESP (Digabungkan)
	
	local removeESP -- [PERBAIKAN] Deklarasi awal
	
	local function updateESP(target, color)
		local localPlayerHead = player.Character and player.Character:FindFirstChild("Head")
		
		if target.Character and target.Character:FindFirstChild("Head") and target.Character:FindFirstChildOfClass("Humanoid") then
			local head = target.Character.Head
			local humanoid = target.Character:FindFirstChildOfClass("Humanoid")

			-- 0. Sembunyikan nama default Roblox (seperti di ESP.lua)
			humanoid.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.None

			-- 1. Update Highlight
			local highlight = target.Character:FindFirstChild("Yogurutto_ESP_Highlight") 
			if not highlight then
				highlight = Instance.new("Highlight") 
				highlight.RobloxLocked = true
				highlight.Name = "Yogurutto_ESP_Highlight"
				highlight.Adornee = target.Character
				highlight.DepthMode = Enum.HighlightDepthMode.AlwaysOnTop --
				highlight.OutlineTransparency = 1 
				highlight.Parent = target.Character
			end
			highlight.FillColor = color --

			-- 2. Update NameTag (BillboardGui)
			local nameTag = espHolder:FindFirstChild(target.Name .. "_NameTag")
			if not nameTag then
				nameTag = espNameTagTemplate:Clone()
				nameTag.Name = target.Name .. "_NameTag"
				nameTag.Adornee = head --
				nameTag.Parent = espHolder
			end
			
			if nameTag.Adornee ~= head then -- Jika karakter respawn
			   	nameTag.Adornee = head
			end
			
			-- 3. Update Teks Nama
			local tagLabel = nameTag:FindFirstChild("Tag")
			if tagLabel then
			    tagLabel.Text = target.DisplayName -- Menampilkan nama
			    tagLabel.TextColor3 = color -- Menyesuaikan warna
			end

			-- 4. [MODIFIKASI] Update Teks Jarak
			local distanceLabel = nameTag:FindFirstChild("Distance")
			if distanceLabel then
				if localPlayerHead then
					local distance = (localPlayerHead.Position - head.Position).Magnitude
					distanceLabel.Text = " " .. math.floor(distance + 0.5) .. " m "
				else
					distanceLabel.Text = " - m " -- Tampil jika player lokal mati
				end
				distanceLabel.TextColor3 = color
			end
		else
			-- Jika karakter tidak ada, hapus ESP
			removeESP(target)
		end
	end

	removeESP = function(target) -- [PERBAIKAN] Hapus 'local'
		-- 1. Hapus Highlight
		if target.Character then
			local highlight = target.Character:FindFirstChild("Yogurutto_ESP_Highlight")
			if highlight then
				highlight:Destroy()
			end

			-- 2. Kembalikan nama default Roblox
			local humanoid = target.Character:FindFirstChildOfClass("Humanoid")
			if humanoid then
				humanoid.DisplayDistanceType = Enum.HumanoidDisplayDistanceType.Viewer
			end
		end

		-- 3. Hapus NameTag
		local nameTag = espHolder:FindFirstChild(target.Name .. "_NameTag")
		if nameTag then
			nameTag:Destroy()
		end
	end

	local stopESP -- Deklarasi awal agar bisa dipanggil oleh toggleESP
	
	local function startESP()
		if espEnabled then return end
		espEnabled = true
		
		stopSpectating() 
		
		espConnection = RunService.Heartbeat:Connect(function() --
			local allPlayers = Players:GetPlayers()
			local activeESPPlayers = {}

			for _, v in ipairs(allPlayers) do
				if v ~= player then
					local color = ESP_USE_TEAM_COLOR and v.TeamColor.Color or ((player.TeamColor == v.TeamColor) and ESP_FRIEND_COLOR or ESP_ENEMY_COLOR) --
					updateESP(v, color) 
					activeESPPlayers[v.Name] = true
				else
					removeESP(v) -- Selalu hapus ESP dari diri sendiri
				end
			end

			-- Cleanup untuk GUI pemain yang keluar
			for _, child in ipairs(espHolder:GetChildren()) do
				if child:IsA("BillboardGui") then
					local playerName = string.gsub(child.Name, "_NameTag", "")
					if not activeESPPlayers[playerName] then
						child:Destroy()
					end
				end
			end
		end)
		
		table.insert(connections, espConnection) 
	end

	stopESP = function()
		if not espEnabled then return end
		espEnabled = false
		
		if espConnection then
			espConnection:Disconnect()
			espConnection = nil
		end
		
		-- Hapus semua ESP yang tersisa
		for _, v in ipairs(Players:GetPlayers()) do
			removeESP(v) 
		end
	end

	-- [MODIFIKASI FLY] Penambahan Fungsi Fly dari Fly.lua
	local function getFlyRoot(char)
		return char:FindFirstChild("HumanoidRootPart")
	end
	
	function startFly()
		if flyEnabled then return end
		
		-- Matikan fitur yang konflik
		stopSpectating()
		if freecamEnabled then
			toggleFreecam() -- Fungsi ini didefinisikan di bawah
		end
	
		repeat task.wait() until player and player.Character and getFlyRoot(player.Character) and player.Character:FindFirstChildOfClass("Humanoid")
		
		if flyKeyDown or flyKeyUp then flyKeyDown:Disconnect() flyKeyUp:Disconnect() end
	
		local T = getFlyRoot(player.Character)
		local CONTROL = flyControl -- Gunakan state variable
		local lCONTROL = fly_lControl -- Gunakan state variable
		local SPEED = 0
		local flyspeed_config = flySpeed -- Gunakan state variable
		local base_speed_config = flyBaseSpeed -- Gunakan state variable
	
		local function FLY()
			flyEnabled = true
			local BG = Instance.new("BodyGyro")
			local BV = Instance.new("BodyVelocity")
			BG.Name = "Yogurutto_FlyGyro"
			BV.Name = "Yogurutto_FlyVelocity"
			BG.P = 9e4
			BG.Parent = T
			BV.Parent = T
			BG.maxTorque = Vector3.new(9e9, 9e9, 9e9)
			BG.cframe = T.CFrame
			BV.velocity = Vector3.new(0, 0, 0)
			BV.maxForce = Vector3.new(9e9, 9e9, 9e9)
			task.spawn(function()
				repeat task.wait()
					if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
						player.Character:FindFirstChildOfClass("Humanoid").PlatformStand = true
					end
					if CONTROL.L + CONTROL.R ~= 0 or CONTROL.F + CONTROL.B ~= 0 or CONTROL.Q + CONTROL.E ~= 0 then
						SPEED = base_speed_config
					elseif not (CONTROL.L + CONTROL.R ~= 0 or CONTROL.F + CONTROL.B ~= 0 or CONTROL.Q + CONTROL.E ~= 0) and SPEED ~= 0 then
						SPEED = 0
					end
					if (CONTROL.L + CONTROL.R) ~= 0 or (CONTROL.F + CONTROL.B) ~= 0 or (CONTROL.Q + CONTROL.E) ~= 0 then
						BV.velocity = ((Workspace.CurrentCamera.CoordinateFrame.lookVector * (CONTROL.F + CONTROL.B)) + ((Workspace.CurrentCamera.CoordinateFrame * CFrame.new(CONTROL.L + CONTROL.R, (CONTROL.F + CONTROL.B + CONTROL.Q + CONTROL.E) * 0.2, 0).p) - Workspace.CurrentCamera.CoordinateFrame.p)) * SPEED
						lCONTROL = {F = CONTROL.F, B = CONTROL.B, L = CONTROL.L, R = CONTROL.R}
					elseif (CONTROL.L + CONTROL.R) == 0 and (CONTROL.F + CONTROL.B) == 0 and (CONTROL.Q + CONTROL.E) == 0 and SPEED ~= 0 then
						BV.velocity = ((Workspace.CurrentCamera.CoordinateFrame.lookVector * (lCONTROL.F + lCONTROL.B)) + ((Workspace.CurrentCamera.CoordinateFrame * CFrame.new(lCONTROL.L + lCONTROL.R, (lCONTROL.F + lCONTROL.B + CONTROL.Q + CONTROL.E) * 0.2, 0).p) - Workspace.CurrentCamera.CoordinateFrame.p)) * SPEED
					else
						BV.velocity = Vector3.new(0, 0, 0)
					end
					BG.cframe = Workspace.CurrentCamera.CoordinateFrame
				until not flyEnabled
				
				flyControl = {F = 0, B = 0, L = 0, R = 0, Q = 0, E = 0} -- Reset state
				fly_lControl = {F = 0, B = 0, L = 0, R = 0, Q = 0, E = 0} -- Reset state
				SPEED = 0
				BG:Destroy()
				BV:Destroy()
				if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
					player.Character:FindFirstChildOfClass("Humanoid").PlatformStand = false
				end
			end)
		end
	
		flyKeyDown = UserInputService.InputBegan:Connect(function(input, gameProcessed)
			if gameProcessed then return end -- Jangan fly jika sedang mengetik
			if not flyEnabled then return end -- Jangan proses jika fly tidak aktif
	
			local KEY = input.KeyCode.Name:lower()
			if KEY == "w" then
				flyControl.F = flyspeed_config
			elseif KEY == "s" then
				flyControl.B = -flyspeed_config
			elseif KEY == "a" then
				flyControl.L = -flyspeed_config
			elseif KEY == "d" then
				flyControl.R = flyspeed_config
			elseif KEY == "e" then -- QEfly di original true
				flyControl.Q = flyspeed_config * 2
			elseif KEY == "q" then
				flyControl.E = -flyspeed_config * 2
			end
			pcall(function() Workspace.CurrentCamera.CameraType = Enum.CameraType.Track end)
		end)
	
		flyKeyUp = UserInputService.InputEnded:Connect(function(input, gameProcessed)
			local KEY = input.KeyCode.Name:lower()
			if KEY == "w" then
				flyControl.F = 0
			elseif KEY == "s" then
				flyControl.B = 0
			elseif KEY == "a" then
				flyControl.L = 0
			elseif KEY == "d" then
				flyControl.R = 0
			elseif KEY == "e" then
				flyControl.Q = 0
			elseif KEY == "q" then
				flyControl.E = 0
			end
		end)
		
		table.insert(connections, flyKeyDown) -- Tambahkan ke cleanup list
		table.insert(connections, flyKeyUp) -- Tambahkan ke cleanup list
	
		FLY()
	end
	
	stopFly = function()
		if not flyEnabled then return end
		flyEnabled = false
		if flyKeyDown or flyKeyUp then 
			flyKeyDown:Disconnect() 
			flyKeyUp:Disconnect()
			flyKeyDown = nil
			flyKeyUp = nil
		end
		
		-- Hapus manual BodyGyro/Velocity jika masih ada
		if player.Character then
			local root = getFlyRoot(player.Character)
			if root then
				local gyro = root:FindFirstChild("Yogurutto_FlyGyro")
				local vel = root:FindFirstChild("Yogurutto_FlyVelocity")
				if gyro then gyro:Destroy() end
				if vel then vel:Destroy() end
			end
			if player.Character:FindFirstChildOfClass("Humanoid") then
				player.Character:FindFirstChildOfClass("Humanoid").PlatformStand = false
			end
		end
		
		pcall(function() Workspace.CurrentCamera.CameraType = Enum.CameraType.Custom end)
	end
	-- [MODIFIKASI FLY] Akhir dari fungsi Fly
	

	--================--
	--       GUI        --
	--================--
	local ScreenGui = Instance.new("ScreenGui")
	ScreenGui.Name = "TeleportControlGui"
	ScreenGui.ResetOnSpawn = false
	ScreenGui.Parent = player:WaitForChild("PlayerGui")

	local MainFrame = Instance.new("Frame")
	MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
	MainFrame.Size = UDim2.new(0, 450, 0, 400)
	MainFrame.AutomaticSize = Enum.AutomaticSize.None
	MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
	MainFrame.BackgroundColor3 = Color3.fromRGB(35, 37, 40)
	MainFrame.BorderColor3 = Color3.fromRGB(80, 80, 80)
	MainFrame.BorderSizePixel = 2
	MainFrame.Parent = ScreenGui

	local UIStroke = Instance.new("UIStroke")
	UIStroke.Thickness = 2
	UIStroke.Color = Color3.fromRGB(255, 255, 255)
	UIStroke.Transparency = 0
	UIStroke.ApplyStrokeMode = Enum.ApplyStrokeMode.Border
	UIStroke.Parent = MainFrame

	task.spawn(function()
		while task.wait(0.05) do
			local hue = (tick() % 5) / 5
			UIStroke.Color = Color3.fromHSV(hue, 1, 1)
		end
	end)

	local UICorner = Instance.new("UICorner")
	UICorner.CornerRadius = UDim.new(0, 8)
	UICorner.Parent = MainFrame

	local UIPadding = Instance.new("UIPadding")
	UIPadding.PaddingTop = UDim.new(0, 10)
	UIPadding.PaddingBottom = UDim.new(0, 10)
	UIPadding.PaddingLeft = UDim.new(0, 10)
	UIPadding.PaddingRight = UDim.new(0, 10)
	UIPadding.Parent = MainFrame

	local MainLayout = Instance.new("UIListLayout")
	MainLayout.Padding = UDim.new(0, 8)
	MainLayout.HorizontalAlignment = Enum.HorizontalAlignment.Center
	MainLayout.FillDirection = Enum.FillDirection.Vertical
	MainLayout.SortOrder = Enum.SortOrder.LayoutOrder
	MainLayout.Parent = MainFrame

	local TitleBar = Instance.new("Frame")
	TitleBar.Size = UDim2.new(1, 0, 0, 30)
	TitleBar.BackgroundColor3 = Color3.fromRGB(224, 49, 49)
	TitleBar.BorderSizePixel = 0
	TitleBar.Parent = MainFrame
	TitleBar.LayoutOrder = 1

	local TitleLabel = Instance.new("TextLabel")
	TitleLabel.Size = UDim2.new(1, 0, 1, 0)
	TitleLabel.BackgroundTransparency = 1
	TitleLabel.Text = "- Khusus All Map -"
	TitleLabel.Font = Enum.Font.GothamBold
	TitleLabel.TextColor3 = Color3.new(1, 1, 1)
	TitleLabel.TextSize = 16
	TitleLabel.Parent = TitleBar

	local TitleCorner = UICorner:Clone()
	TitleCorner.Parent = TitleBar

	local ContentContainer = Instance.new("Frame")
	ContentContainer.Size = UDim2.new(1, 0, 1, -68)
	ContentContainer.BackgroundTransparency = 1
	ContentContainer.LayoutOrder = 2
	ContentContainer.Parent = MainFrame

	local ContentLayout = Instance.new("UIListLayout")
	ContentLayout.FillDirection = Enum.FillDirection.Horizontal
	ContentLayout.SortOrder = Enum.SortOrder.LayoutOrder
	ContentLayout.VerticalAlignment = Enum.VerticalAlignment.Top
	ContentLayout.Padding = UDim.new(0, 10)
	ContentLayout.Parent = ContentContainer

	-- [MODIFIKASI 2 KOLOM] Kolom Kiri ditambahkan
	local LeftColumn = Instance.new("Frame")
	LeftColumn.Name = "LeftColumn"
	LeftColumn.Size = UDim2.new(0.5, -5, 1, 0) -- Setengah lebar, dikurangi 5px untuk padding
	LeftColumn.BackgroundTransparency = 1
	LeftColumn.LayoutOrder = 1 -- Agar muncul di kiri
	LeftColumn.Parent = ContentContainer

	local LeftColumnLayout = Instance.new("UIListLayout")
	LeftColumnLayout.Padding = UDim.new(0, 8)
	LeftColumnLayout.SortOrder = Enum.SortOrder.LayoutOrder
	LeftColumnLayout.Parent = LeftColumn

	-- [MODIFIKASI 2 KOLOM] Kolom Kanan disesuaikan
	local RightColumn = Instance.new("Frame")
	RightColumn.Name = "RightColumn"
	RightColumn.Size = UDim2.new(0.5, -5, 1, 0) -- Setengah lebar
	RightColumn.BackgroundTransparency = 1
	RightColumn.LayoutOrder = 2 -- Agar muncul di kanan
	RightColumn.Parent = ContentContainer

	local RightColumnLayout = Instance.new("UIListLayout")
	RightColumnLayout.Padding = UDim.new(0, 8)
	RightColumnLayout.SortOrder = Enum.SortOrder.LayoutOrder
	RightColumnLayout.Parent = RightColumn

	local CreditLabel = Instance.new("TextLabel")
	CreditLabel.Size = UDim2.new(1, 0, 0, 25)
	CreditLabel.BackgroundTransparency = 1
	CreditLabel.Font = Enum.Font.GothamBold
	CreditLabel.TextSize = 12
	CreditLabel.RichText = true
	CreditLabel.TextColor3 = Color3.new(0.7, 0.7, 0.7)
	CreditLabel.Text = "By <font color='rgb(255, 80, 80)'><b><i>Yogurutto</i></b></font>"
	CreditLabel.TextXAlignment = Enum.TextXAlignment.Center
	CreditLabel.Parent = MainFrame
	CreditLabel.LayoutOrder = 3

	local PlayerTeleportTitle = Instance.new("TextLabel")
	PlayerTeleportTitle.Size = UDim2.new(1, 0, 0, 20)
	PlayerTeleportTitle.BackgroundTransparency = 1
	PlayerTeleportTitle.Font = Enum.Font.GothamBold
	PlayerTeleportTitle.Text = "Teleport ke Pemain"
	PlayerTeleportTitle.TextSize = 14
	PlayerTeleportTitle.TextColor3 = Color3.new(0.9, 0.9, 0.9)
	PlayerTeleportTitle.TextYAlignment = Enum.TextYAlignment.Bottom
	PlayerTeleportTitle.Parent = LeftColumn
	PlayerTeleportTitle.LayoutOrder = 1

	local SearchRefreshContainer = Instance.new("Frame")
	SearchRefreshContainer.Size = UDim2.new(1, 0, 0, 30)
	SearchRefreshContainer.BackgroundTransparency = 1
	SearchRefreshContainer.LayoutOrder = 2
	SearchRefreshContainer.Parent = LeftColumn -- [MODIFIKASI 2 KOLOM]

	local SearchRefreshLayout = Instance.new("UIListLayout")
	SearchRefreshLayout.FillDirection = Enum.FillDirection.Horizontal
	SearchRefreshLayout.SortOrder = Enum.SortOrder.LayoutOrder
	SearchRefreshLayout.VerticalAlignment = Enum.VerticalAlignment.Center
	SearchRefreshLayout.Padding = UDim.new(0, 5)
	SearchRefreshLayout.Parent = SearchRefreshContainer

	local PlayerSearchBox = Instance.new("TextBox")
	PlayerSearchBox.Name = "PlayerSearchBox"
	PlayerSearchBox.Size = UDim2.new(1, -35, 1, 0)
	PlayerSearchBox.BackgroundColor3 = Color3.fromRGB(45, 47, 50)
	PlayerSearchBox.Font = Enum.Font.Gotham
	PlayerSearchBox.TextColor3 = Color3.new(0.9, 0.9, 0.9)
	PlayerSearchBox.PlaceholderColor3 = Color3.fromRGB(150, 150, 150)
	PlayerSearchBox.TextSize = 13
	PlayerSearchBox.Text = ""
	PlayerSearchBox.PlaceholderText = "Cari pemain..."
	PlayerSearchBox.ClearTextOnFocus = false
	PlayerSearchBox.Parent = SearchRefreshContainer

	local SearchBoxCorner = UICorner:Clone()
	SearchBoxCorner.Parent = PlayerSearchBox

	local RefreshPlayersButton = Instance.new("TextButton")
	RefreshPlayersButton.Name = "RefreshButton"
	RefreshPlayersButton.Size = UDim2.new(0, 30, 1, 0)
	RefreshPlayersButton.BackgroundColor3 = Color3.fromRGB(60, 63, 66)
	RefreshPlayersButton.Font = Enum.Font.GothamBold
	RefreshPlayersButton.Text = "🔄"
	RefreshPlayersButton.TextColor3 = Color3.new(1, 1, 1)
	RefreshPlayersButton.TextSize = 16
	RefreshPlayersButton.Parent = SearchRefreshContainer

	local RefreshBtnCorner = UICorner:Clone()
	RefreshBtnCorner.Parent = RefreshPlayersButton

	local PlayerScrollFrame = Instance.new("ScrollingFrame")
	-- [MODIFIKASI 2 KOLOM] Ukuran disesuaikan untuk layout 2 kolom
	PlayerScrollFrame.Size = UDim2.new(1, 0, 1, -66) 
	PlayerScrollFrame.BackgroundColor3 = Color3.fromRGB(45, 47, 50)
	PlayerScrollFrame.BorderSizePixel = 0
	PlayerScrollFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
	PlayerScrollFrame.ScrollBarImageColor3 = Color3.fromRGB(150, 150, 150)
	PlayerScrollFrame.ScrollBarThickness = 6
	PlayerScrollFrame.Parent = LeftColumn -- [MODIFIKASI 2 KOLOM]
	PlayerScrollFrame.LayoutOrder = 3

	local PlayerScrollCorner = UICorner:Clone()
	PlayerScrollCorner.Parent = PlayerScrollFrame

	local PlayerListLayout = Instance.new("UIListLayout")
	PlayerListLayout.Padding = UDim.new(0, 5)
	PlayerListLayout.SortOrder = Enum.SortOrder.LayoutOrder
	PlayerListLayout.Parent = PlayerScrollFrame

	local FiturLainnyaTitle = Instance.new("TextLabel")
	FiturLainnyaTitle.Size = UDim2.new(1, 0, 0, 20)
	FiturLainnyaTitle.BackgroundTransparency = 1
	FiturLainnyaTitle.Font = Enum.Font.GothamBold
	FiturLainnyaTitle.Text = "Fitur Lainnya"
	FiturLainnyaTitle.TextSize = 14
	FiturLainnyaTitle.TextColor3 = Color3.new(0.9, 0.9, 0.9)
	FiturLainnyaTitle.TextYAlignment = Enum.TextYAlignment.Bottom
	FiturLainnyaTitle.Parent = RightColumn
	FiturLainnyaTitle.LayoutOrder = 1
	
	local WalkspeedSliderContainer = Instance.new("Frame")
	WalkspeedSliderContainer.Size = UDim2.new(1, 0, 0, 35)
	WalkspeedSliderContainer.BackgroundTransparency = 1
	WalkspeedSliderContainer.LayoutOrder = 4
	WalkspeedSliderContainer.Parent = RightColumn

	local WalkspeedValueLabel = Instance.new("TextLabel")
	WalkspeedValueLabel.Size = UDim2.new(1, 0, 0, 15)
	WalkspeedValueLabel.BackgroundTransparency = 1
	WalkspeedValueLabel.Font = Enum.Font.Gotham
	WalkspeedValueLabel.TextColor3 = Color3.new(1, 1, 1)
	WalkspeedValueLabel.TextSize = 13
	WalkspeedValueLabel.Text = string.format("Walkspeed: %d", currentWalkSpeed)
	WalkspeedValueLabel.Parent = WalkspeedSliderContainer

	local WalkspeedSliderTrack = Instance.new("Frame")
	WalkspeedSliderTrack.Size = UDim2.new(1, 0, 0, 8)
	WalkspeedSliderTrack.Position = UDim2.new(0, 0, 0, 18)
	WalkspeedSliderTrack.BackgroundColor3 = Color3.fromRGB(60, 63, 66)
	WalkspeedSliderTrack.BorderSizePixel = 0
	WalkspeedSliderTrack.Parent = WalkspeedSliderContainer
	local wsTrackCorner = Instance.new("UICorner")
	wsTrackCorner.CornerRadius = UDim.new(1,0)
	wsTrackCorner.Parent = WalkspeedSliderTrack

	local WalkspeedSliderHandle = Instance.new("TextButton")
	WalkspeedSliderHandle.Size = UDim2.new(0, 16, 0, 16)
	WalkspeedSliderHandle.AnchorPoint = Vector2.new(0.5, 0.5)
	WalkspeedSliderHandle.Position = UDim2.new(0, 0, 0.5, 0)
	WalkspeedSliderHandle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
	WalkspeedSliderHandle.BorderSizePixel = 0
	WalkspeedSliderHandle.Text = ""
	WalkspeedSliderHandle.Parent = WalkspeedSliderTrack
	local wsHandleCorner = Instance.new("UICorner")
	wsHandleCorner.CornerRadius = UDim.new(1,0)
	wsHandleCorner.Parent = WalkspeedSliderHandle

	local JumpSliderContainer = Instance.new("Frame")
	JumpSliderContainer.Size = UDim2.new(1, 0, 0, 35)
	JumpSliderContainer.BackgroundTransparency = 1
	JumpSliderContainer.LayoutOrder = 5
	JumpSliderContainer.Parent = RightColumn

	local JumpValueLabel = Instance.new("TextLabel")
	JumpValueLabel.Size = UDim2.new(1, 0, 0, 15)
	JumpValueLabel.BackgroundTransparency = 1
	JumpValueLabel.Font = Enum.Font.Gotham
	JumpValueLabel.TextColor3 = Color3.new(1, 1, 1)
	JumpValueLabel.TextSize = 13
	JumpValueLabel.Text = string.format("Jump: %d", currentJumpPower)
	JumpValueLabel.Parent = JumpSliderContainer

	local JumpSliderTrack = Instance.new("Frame")
	JumpSliderTrack.Size = UDim2.new(1, 0, 0, 8)
	JumpSliderTrack.Position = UDim2.new(0, 0, 0, 18)
	JumpSliderTrack.BackgroundColor3 = Color3.fromRGB(60, 63, 66)
	JumpSliderTrack.BorderSizePixel = 0
	JumpSliderTrack.Parent = JumpSliderContainer
	local jumpTrackCorner = wsTrackCorner:Clone()
	jumpTrackCorner.Parent = JumpSliderTrack

	local JumpSliderHandle = Instance.new("TextButton")
	JumpSliderHandle.Size = UDim2.new(0, 16, 0, 16)
	JumpSliderHandle.AnchorPoint = Vector2.new(0.5, 0.5)
	JumpSliderHandle.Position = UDim2.new(0, 0, 0.5, 0)
	JumpSliderHandle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
	JumpSliderHandle.BorderSizePixel = 0
	JumpSliderHandle.Text = ""
	JumpSliderHandle.Parent = JumpSliderTrack
	local jumpHandleCorner = wsHandleCorner:Clone()
	jumpHandleCorner.Parent = JumpSliderHandle

	-- [MODIFIKASI] GravitySliderContainer ditambahkan
	local GravitySliderContainer = Instance.new("Frame")
	GravitySliderContainer.Size = UDim2.new(1, 0, 0, 35)
	GravitySliderContainer.BackgroundTransparency = 1
	GravitySliderContainer.LayoutOrder = 6 -- Urutan baru
	GravitySliderContainer.Parent = RightColumn

	local GravityValueLabel = Instance.new("TextLabel")
	GravityValueLabel.Size = UDim2.new(1, 0, 0, 15)
	GravityValueLabel.BackgroundTransparency = 1
	GravityValueLabel.Font = Enum.Font.Gotham
	GravityValueLabel.TextColor3 = Color3.new(1, 1, 1)
	GravityValueLabel.TextSize = 13
	GravityValueLabel.Text = string.format("Gravity: %.1f", currentGravity)
	GravityValueLabel.Parent = GravitySliderContainer

	local GravitySliderTrack = Instance.new("Frame")
	GravitySliderTrack.Size = UDim2.new(1, 0, 0, 8)
	GravitySliderTrack.Position = UDim2.new(0, 0, 0, 18)
	GravitySliderTrack.BackgroundColor3 = Color3.fromRGB(60, 63, 66)
	GravitySliderTrack.BorderSizePixel = 0
	GravitySliderTrack.Parent = GravitySliderContainer
	local gravityTrackCorner = wsTrackCorner:Clone()
	gravityTrackCorner.Parent = GravitySliderTrack

	local GravitySliderHandle = Instance.new("TextButton")
	GravitySliderHandle.Size = UDim2.new(0, 16, 0, 16)
	GravitySliderHandle.AnchorPoint = Vector2.new(0.5, 0.5)
	GravitySliderHandle.Position = UDim2.new(0, 0, 0.5, 0)
	GravitySliderHandle.BackgroundColor3 = Color3.fromRGB(200, 200, 200)
	GravitySliderHandle.BorderSizePixel = 0
	GravitySliderHandle.Text = ""
	GravitySliderHandle.Parent = GravitySliderTrack
	local gravityHandleCorner = wsHandleCorner:Clone()
	gravityHandleCorner.Parent = GravitySliderHandle

	-- Tombol Emote
	local EmoteButton = Instance.new("TextButton")
	EmoteButton.Size = UDim2.new(1, 0, 0, 35)
	EmoteButton.BackgroundColor3 = Color3.fromRGB(88, 141, 214)
	EmoteButton.Text = "Emote"
	EmoteButton.Font = Enum.Font.GothamBold
	EmoteButton.TextSize = 16
	EmoteButton.TextColor3 = Color3.new(1, 1, 1)
	EmoteButton.Parent = RightColumn
	EmoteButton.LayoutOrder = 7 -- Urutan baru

	local EmoteBtnCorner = UICorner:Clone()
	EmoteBtnCorner.Parent = EmoteButton

	-- Tombol Commands
	local CommandsButton = Instance.new("TextButton")
	CommandsButton.Size = UDim2.new(1, 0, 0, 35)
	CommandsButton.BackgroundColor3 = Color3.fromRGB(88, 141, 214)
	CommandsButton.Text = "Commands"
	CommandsButton.Font = Enum.Font.GothamBold
	CommandsButton.TextSize = 16
	CommandsButton.TextColor3 = Color3.new(1, 1, 1)
	CommandsButton.Parent = RightColumn
	CommandsButton.LayoutOrder = 8 -- Urutan baru

	local CommandsBtnCorner = UICorner:Clone()
	CommandsBtnCorner.Parent = CommandsButton

	-- [MODIFIKASI ESP] Tombol ESP
	local ESPButton = Instance.new("TextButton")
	ESPButton.Name = "ESPButton"
	ESPButton.Size = UDim2.new(1, 0, 0, 35)
	ESPButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60) -- Merah (Mati)
	ESPButton.Text = "ESP: OFF"
	ESPButton.Font = Enum.Font.GothamBold
	ESPButton.TextSize = 16
	ESPButton.TextColor3 = Color3.new(1, 1, 1)
	ESPButton.Parent = RightColumn
	ESPButton.LayoutOrder = 9 -- Urutan baru (setelah CommandsButton)
	
	local ESPBtnCorner = UICorner:Clone()
	ESPBtnCorner.Parent = ESPButton

	-- [MODIFIKASI FLY] Tombol Fly
	local FlyButton = Instance.new("TextButton")
	FlyButton.Name = "FlyButton"
	FlyButton.Size = UDim2.new(1, 0, 0, 35)
	FlyButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60) -- Merah (Mati)
	FlyButton.Text = "Fly: OFF"
	FlyButton.Font = Enum.Font.GothamBold
	FlyButton.TextSize = 16
	FlyButton.TextColor3 = Color3.new(1, 1, 1)
	FlyButton.Parent = RightColumn
	FlyButton.LayoutOrder = 10 -- Urutan baru (setelah ESPButton)
	
	local FlyBtnCorner = UICorner:Clone()
	FlyBtnCorner.Parent = FlyButton
	-- [MODIFIKASI FLY] Akhir Tombol Fly

	--================================--
	-- LOGIC TELEPORT PEMAIN --
	--================================--
	
	local function updatePlayerList(searchText)
		for _, v in pairs(PlayerScrollFrame:GetChildren()) do
			if v:IsA("Frame") then v:Destroy() end
		end
		
		local lowerSearchText = (searchText and searchText ~= "") and string.lower(searchText) or nil
		
		for i, targetPlayer in ipairs(Players:GetPlayers()) do
			local nameMatches = true
			if lowerSearchText then
				local lowerDisplayName = string.lower(targetPlayer.DisplayName)
				local lowerName = string.lower(targetPlayer.Name)
				if not string.find(lowerDisplayName, lowerSearchText, 1, true) and not string.find(lowerName, lowerSearchText, 1, true) then
					nameMatches = false
				end
			end

			if targetPlayer ~= player and nameMatches then
				local PlayerFrame = Instance.new("Frame")
				PlayerFrame.Name = targetPlayer.Name .. "_Frame"
				PlayerFrame.Size = UDim2.new(1, 0, 0, 30)
				PlayerFrame.BackgroundTransparency = 1
				PlayerFrame.LayoutOrder = i
				PlayerFrame.Parent = PlayerScrollFrame
				
				local PlayerFrameLayout = Instance.new("UIListLayout")
				PlayerFrameLayout.FillDirection = Enum.FillDirection.Horizontal
				PlayerFrameLayout.SortOrder = Enum.SortOrder.LayoutOrder
				PlayerFrameLayout.VerticalAlignment = Enum.VerticalAlignment.Center
				PlayerFrameLayout.Padding = UDim.new(0, 5)
				PlayerFrameLayout.Parent = PlayerFrame

				local PlayerNameLabel = Instance.new("TextLabel")
				PlayerNameLabel.Name = "PlayerName"
				PlayerNameLabel.Size = UDim2.new(1, -80, 1, 0)
				PlayerNameLabel.BackgroundColor3 = Color3.fromRGB(60, 63, 66)
				PlayerNameLabel.Text = targetPlayer.DisplayName
				PlayerNameLabel.Font = Enum.Font.Gotham
				PlayerNameLabel.TextColor3 = Color3.new(1, 1, 1)
				PlayerNameLabel.TextSize = 14
				PlayerNameLabel.TextXAlignment = Enum.TextXAlignment.Left
				PlayerNameLabel.Parent = PlayerFrame
				local nameCorner = UICorner:Clone()
				nameCorner.Parent = PlayerNameLabel
				
				local namePadding = Instance.new("UIPadding")
				namePadding.PaddingLeft = UDim.new(0, 5)
				namePadding.Parent = PlayerNameLabel

				local TPButton = Instance.new("TextButton")
				TPButton.Name = "TPButton"
				TPButton.Size = UDim2.new(0, 30, 1, 0)
				TPButton.BackgroundColor3 = Color3.fromRGB(80, 160, 80)
				TPButton.Text = "TP"
				TPButton.Font = Enum.Font.GothamBold
				TPButton.TextColor3 = Color3.new(1, 1, 1)
				TPButton.TextSize = 14
				TPButton.Parent = PlayerFrame
				local tpBtnCorner = UICorner:Clone()
				tpBtnCorner.Parent = TPButton
				
				local SpecButton = Instance.new("TextButton")
				SpecButton.Name = "SpecButton"
				SpecButton.Size = UDim2.new(0, 30, 1, 0)
				SpecButton.BackgroundColor3 = Color3.fromRGB(80, 80, 160)
				SpecButton.Text = "👁️"
				SpecButton.Font = Enum.Font.GothamBold
				SpecButton.TextColor3 = Color3.new(1, 1, 1)
				SpecButton.TextSize = 14
				SpecButton.Parent = PlayerFrame
				local specBtnCorner = UICorner:Clone()
				specBtnCorner.Parent = SpecButton

				table.insert(connections, TPButton.MouseButton1Click:Connect(function()
					stopSpectating() 
					if player.Character and targetPlayer.Character and targetPlayer.Character:FindFirstChild("HumanoidRootPart") then
						teleportCharacter(player.Character, targetPlayer.Character.HumanoidRootPart.Position)
					end
				end))
				
				table.insert(connections, SpecButton.MouseButton1Click:Connect(function()
					if isSpectating and spectateTarget == targetPlayer then
						stopSpectating()
					else
						startSpectating(targetPlayer)
					end
				end))
			end
		end
		PlayerScrollFrame.CanvasSize = UDim2.new(0, 0, 0, PlayerListLayout.AbsoluteContentSize.Y)
	end

	--=======================--
	-- SLIDER & DRAG LOGIC --
	--=======================--
	local dragging = false
	local dragStart, frameStart

	local function startDrag(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = true
			dragStart = UserInputService:GetMouseLocation()
			frameStart = MainFrame.Position
		end
	end

	table.insert(connections, TitleBar.InputBegan:Connect(startDrag))

	local function updateJumpSliderPosition(mouseX)
		local trackStart = JumpSliderTrack.AbsolutePosition.X
		local trackWidth = JumpSliderTrack.AbsoluteSize.X
		local handleX = math.clamp(mouseX - trackStart, 0, trackWidth)
		local percentage = handleX / trackWidth
		JumpSliderHandle.Position = UDim2.new(percentage, 0, 0.5, 0)
		
		currentJumpPower = MIN_JUMPPOWER + (MAX_JUMPPOWER - MIN_JUMPPOWER) * percentage
		JumpValueLabel.Text = string.format("Jump: %d", math.floor(currentJumpPower))
		
		if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
			player.Character.Humanoid.JumpPower = currentJumpPower
		end
	end

	local function updateWalkspeedSliderPosition(mouseX)
		local trackStart = WalkspeedSliderTrack.AbsolutePosition.X
		local trackWidth = WalkspeedSliderTrack.AbsoluteSize.X
		local handleX = math.clamp(mouseX - trackStart, 0, trackWidth)
		local percentage = handleX / trackWidth
		
		WalkspeedSliderHandle.Position = UDim2.new(percentage, 0, 0.5, 0)
		currentWalkSpeed = MIN_WALKSPEED + (MAX_WALKSPEED - MIN_WALKSPEED) * percentage
		WalkspeedValueLabel.Text = string.format("Walkspeed: %d", math.floor(currentWalkSpeed))
		
		if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
			player.Character.Humanoid.WalkSpeed = currentWalkSpeed
		end
	end

	-- [MODIFIKASI] Fungsi untuk slider Gravity
	local function updateGravitySliderPosition(mouseX)
		local trackStart = GravitySliderTrack.AbsolutePosition.X
		local trackWidth = GravitySliderTrack.AbsoluteSize.X
		local handleX = math.clamp(mouseX - trackStart, 0, trackWidth)
		local percentage = handleX / trackWidth
		GravitySliderHandle.Position = UDim2.new(percentage, 0, 0.5, 0)
		
		currentGravity = MIN_GRAVITY + (MAX_GRAVITY - MIN_GRAVITY) * percentage
		GravityValueLabel.Text = string.format("Gravity: %.1f", currentGravity)
		
		Workspace.Gravity = currentGravity
	end

	-- [MODIFIKASI] InputBegan untuk semua slider
	table.insert(connections, JumpSliderHandle.InputBegan:Connect(function() isDraggingJumpSlider = true; isDraggingWalkspeedSlider = false; isDraggingGravitySlider = false end))
	table.insert(connections, WalkspeedSliderHandle.InputBegan:Connect(function() isDraggingWalkspeedSlider = true; isDraggingJumpSlider = false; isDraggingGravitySlider = false end))
	table.insert(connections, GravitySliderHandle.InputBegan:Connect(function() isDraggingGravitySlider = true; isDraggingWalkspeedSlider = false; isDraggingJumpSlider = false end))

	table.insert(connections, JumpSliderTrack.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			isDraggingJumpSlider = true; isDraggingWalkspeedSlider = false; isDraggingGravitySlider = false; updateJumpSliderPosition(input.Position.X)
		end
	end))

	table.insert(connections, WalkspeedSliderTrack.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			isDraggingWalkspeedSlider = true; isDraggingJumpSlider = false;
			isDraggingGravitySlider = false; updateWalkspeedSliderPosition(input.Position.X)
		end
	end))
	
	table.insert(connections, GravitySliderTrack.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			isDraggingGravitySlider = true; isDraggingWalkspeedSlider = false; isDraggingJumpSlider = false; updateGravitySliderPosition(input.Position.X)
		end
	end))

	-- [MODIFIKASI] InputChanged untuk semua slider
	table.insert(connections, UserInputService.InputChanged:Connect(function(input)
		if (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			if isDraggingJumpSlider and (UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) or input.UserInputType == Enum.UserInputType.Touch) then
				updateJumpSliderPosition(input.Position.X)
			end
			if isDraggingWalkspeedSlider and (UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) or input.UserInputType == Enum.UserInputType.Touch) then
				updateWalkspeedSliderPosition(input.Position.X)
			end
			if isDraggingGravitySlider and (UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) or input.UserInputType == Enum.UserInputType.Touch) then
				updateGravitySliderPosition(input.Position.X)
			end
		end
		
		if dragging and (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
			local currentPos = UserInputService:GetMouseLocation()
			local delta = currentPos - dragStart
			MainFrame.Position = UDim2.new(frameStart.X.Scale, frameStart.X.Offset + delta.X, frameStart.Y.Scale, frameStart.Y.Offset + delta.Y)
		end
	end))

	table.insert(connections, UserInputService.InputEnded:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			dragging = false; isDraggingJumpSlider = false; isDraggingWalkspeedSlider = false; isDraggingGravitySlider = false;
		end
	end))

	-- [MODIFIKASI] Inisialisasi posisi semua slider
	task.wait()
	local initialJumpPercentage = (currentJumpPower - MIN_JUMPPOWER) / (MAX_JUMPPOWER - MIN_JUMPPOWER)
	JumpSliderHandle.Position = UDim2.new(initialJumpPercentage, 0, 0.5, 0)
	local initialWalkspeedPercentage = (currentWalkSpeed - MIN_WALKSPEED) / (MAX_WALKSPEED - MIN_WALKSPEED)
	WalkspeedSliderHandle.Position = UDim2.new(initialWalkspeedPercentage, 0, 0.5, 0)
	local initialGravityPercentage = (currentGravity - MIN_GRAVITY) / (MAX_GRAVITY - MIN_GRAVITY)
	GravitySliderHandle.Position = UDim2.new(initialGravityPercentage, 0, 0.5, 0)

	--================--
	-- EVENT HANDLERS --
	--================--
	local function toggleGUIVisibility()
		MainFrame.Visible = not MainFrame.Visible
	end

	table.insert(connections, EmoteButton.MouseButton1Click:Connect(function()
		task.spawn(function()
			loadstring(game:HttpGet("https://rawscripts.net/raw/Universal-Script-7yd7-I-Emote-Script-48024"))()
		end)
	end))

	table.insert(connections, CommandsButton.MouseButton1Click:Connect(function()
		stopSpectating() 
		task.spawn(function()
			loadstring(game:HttpGet('https://raw.githubusercontent.com/EdgeIY/infiniteyield/master/source'))()
		end)
	end))

	-- [MODIFIKASI ESP] Logic Tombol ESP
	local function toggleESP()
		if espEnabled then
			stopESP()
			ESPButton.Text = "ESP: OFF"
			ESPButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60) -- Merah
		else
			startESP()
			ESPButton.Text = "ESP: ON"
			ESPButton.BackgroundColor3 = Color3.fromRGB(60, 200, 60) -- Hijau
		end
	end
	
	table.insert(connections, ESPButton.MouseButton1Click:Connect(toggleESP))

	-- [MODIFIKASI FLY] Logic Tombol Fly
	toggleFly = function() -- Diubah agar bisa dipanggil oleh keybind
		if flyEnabled then
			stopFly()
			FlyButton.Text = "Fly: OFF"
			FlyButton.BackgroundColor3 = Color3.fromRGB(200, 60, 60) -- Merah
		else
			-- Cek konflik sebelum start
			stopSpectating()
			if freecamEnabled then
				toggleFreecam() -- Fungsi ini ada di bawah, akan otomatis mematikan freecam
			end
			
			startFly()
			FlyButton.Text = "Fly: ON"
			FlyButton.BackgroundColor3 = Color3.fromRGB(60, 200, 60) -- Hijau
		end
	end
	
	table.insert(connections, FlyButton.MouseButton1Click:Connect(toggleFly))
	-- [MODIFIKASI FLY] Akhir Logic Tombol Fly

	table.insert(connections, RefreshPlayersButton.MouseButton1Click:Connect(function()
		PlayerSearchBox.Text = ""
		updatePlayerList()
	end))

	table.insert(connections, PlayerSearchBox.Changed:Connect(function(property)
		if property == "Text" then
			updatePlayerList(PlayerSearchBox.Text)
		end
	end))

	--===[ PLAYER & CHARACTER EVENTS ]===--
	local function onCharacterAdded(character)
		local humanoid = character:WaitForChild("Humanoid")
		humanoid.WalkSpeed = currentWalkSpeed
		humanoid.JumpPower = currentJumpPower
		Workspace.Gravity = currentGravity 
		
		if not isSpectating and not freecamEnabled then
			Workspace.CurrentCamera.CameraSubject = humanoid
		end
	end

	table.insert(connections, player.CharacterAdded:Connect(onCharacterAdded))
	table.insert(connections, Players.PlayerAdded:Connect(function() updatePlayerList(PlayerSearchBox.Text) end))
	
	table.insert(connections, Players.PlayerRemoving:Connect(function(removedPlayer)
		if isSpectating and spectateTarget == removedPlayer then
			stopSpectating() 
		end
		updatePlayerList(PlayerSearchBox.Text)
	end))


	--========================--
	--  NEW FREECAM MODULE    --
	--========================--
	local FreecamModule = (function()
		local v1 = {}
		local v_u_3 = math.abs
		local v_u_4 = math.clamp
		local v_u_5 = math.exp
		local v_u_6 = math.rad
		local v_u_7 = math.sign
		local v_u_8 = math.sqrt
		local v_u_9 = math.tan
		local v_u_10 = game:GetService("ContextActionService")
		local v11 = game:GetService("Players")
		local v_u_12 = game:GetService("RunService")
		local v_u_13 = game:GetService("StarterGui")
		local v_u_14 = game:GetService("UserInputService")
		local v_u_15 = game:GetService("Workspace")
		local v_u_16 = v11.LocalPlayer
		if not v_u_16 then
			v11:GetPropertyChangedSignal("LocalPlayer"):Wait()
			v_u_16 = v11.LocalPlayer
		end
		local v_u_17 = v_u_15.CurrentCamera
		table.insert(connections, v_u_15:GetPropertyChangedSignal("CurrentCamera"):Connect(function()
			local v18 = v_u_15.CurrentCamera
			if v18 then
				v_u_17 = v18
			end
		end))
		local v_u_19 = Enum.ContextActionPriority.High.Value
		local v_u_20 = Vector2.new(0.75, 1) * 8
		local v_u_21 = {}
		v_u_21.__index = v_u_21
		function v_u_21.new(p22, p23)
			local v24 = v_u_21
			local v25 = setmetatable({}, v24)
			v25.f = p22
			v25.p = p23
			v25.v = p23 * 0
			return v25
		end
		function v_u_21.Update(p26, p27, p28)
			local v29 = p26.f * 2 * 3.141592653589793
			local v30 = p26.p
			local v31 = p26.v
			local v32 = p28 - v30
			local v33 = v_u_5(-v29 * p27)
			local v34 = p28 + (v31 * p27 - v32 * (v29 * p27 + 1)) * v33
			local v35 = (v29 * p27 * (v32 * v29 - v31) + v31) * v33
			p26.p = v34
			p26.v = v35
			return v34
		end
		function v_u_21.Reset(p36, p37)
			p36.p = p37
			p36.v = p37 * 0
		end
		local v_u_38 = Vector3.new()
		local v_u_39 = Vector2.new()
		local v_u_40 = 0
		local v_u_41 = v_u_21.new(1.5, (Vector3.new()))
		local v_u_42 = v_u_21.new(1, Vector2.new())
		local v_u_43 = v_u_21.new(4, 0)
		local v_u_44 = {}
		local function v_u_46(p45)
			return v_u_7(p45) * v_u_4((v_u_5(2 * ((v_u_3(p45) - 0.15) / 0.85)) - 1) / 6.38905609893065, 0, 1)
		end
		local v_u_47 = { ButtonX = 0, ButtonY = 0, DPadDown = 0, DPadUp = 0, ButtonL2 = 0, ButtonR2 = 0, Thumbstick1 = Vector2.new(), Thumbstick2 = Vector2.new() }
		local v_u_48 = { W = 0, A = 0, S = 0, D = 0, E = 0, Q = 0, U = 0, H = 0, J = 0, K = 0, I = 0, Y = 0, Up = 0, Down = 0, LeftShift = 0, RightShift = 0 }
		local v_u_49 = { Delta = Vector2.new(), MouseWheel = 0 }
		local v_u_50 = Vector2.new(1, 1) * 0.04908738521234052
		local v_u_51 = Vector2.new(1, 1) * 0.39269908169872414
		local v_u_52 = 1
		function v_u_44.Vel(p53)
			v_u_52 = v_u_4(v_u_52 + p53 * (v_u_48.Up - v_u_48.Down) * 0.75, 0.01, 4)
			local v54 = v_u_46(v_u_47.Thumbstick1.X)
			local v55 = v_u_46(v_u_47.ButtonR2) - v_u_46(v_u_47.ButtonL2)
			local v56 = v_u_46
			local v57 = -v_u_47.Thumbstick1.Y
			local v58 = Vector3.new(v54, v55, v56(v57)) * Vector3.new(1, 1, 1)
			local v59 = v_u_48.D - v_u_48.A + v_u_48.K - v_u_48.H
			local v60 = v_u_48.E - v_u_48.Q + v_u_48.I - v_u_48.Y
			local v61 = v_u_48.S - v_u_48.W + v_u_48.J - v_u_48.U
			local v62 = Vector3.new(v59, v60, v61) * Vector3.new(1, 1, 1)
			local v63 = v_u_14:IsKeyDown(Enum.KeyCode.LeftShift) or v_u_14:IsKeyDown(Enum.KeyCode.RightShift)
			return (v58 + v62) * (v_u_52 * (v63 and 0.25 or 1))
		end
		function v_u_44.Pan(_)
			local v64 = Vector2.new(v_u_46(v_u_47.Thumbstick2.Y), v_u_46(-v_u_47.Thumbstick2.X)) * v_u_51
			local v65 = v_u_49.Delta * v_u_50
			v_u_49.Delta = Vector2.new()
			return v64 + v65
		end
		function v_u_44.Fov(_)
			local v66 = (v_u_47.ButtonX - v_u_47.ButtonY) * 0.25
			local v67 = v_u_49.MouseWheel * 1
			v_u_49.MouseWheel = 0
			return v66 + v67
		end
		local function v_u_70(_, p68, p69)
			v_u_48[p69.KeyCode.Name] = p68 == Enum.UserInputState.Begin and 1 or 0
			return Enum.ContextActionResult.Sink
		end
		local function v_u_73(_, p71, p72)
			v_u_47[p72.KeyCode.Name] = p71 == Enum.UserInputState.Begin and 1 or 0
			return Enum.ContextActionResult.Sink
		end
		local function v_u_76(_, _, p74)
			local v75 = p74.Delta
			v_u_49.Delta = Vector2.new(-v75.y, -v75.x)
			return Enum.ContextActionResult.Sink
		end
		local function v_u_78(_, _, p77)
			v_u_47[p77.KeyCode.Name] = p77.Position
			return Enum.ContextActionResult.Sink
		end
		local function v_u_80(_, _, p79)
			v_u_47[p79.KeyCode.Name] = p79.Position.z
			return Enum.ContextActionResult.Sink
		end
		local function v_u_82(_, _, p81)
			v_u_49[p81.UserInputType.Name] = -p81.Position.z
			return Enum.ContextActionResult.Sink
		end
		local v_u_83 = nil
		function v_u_44.StartCapture()
			v_u_10:BindActionAtPriority("FreecamKeyboard", v_u_70, false, v_u_19, Enum.KeyCode.W, Enum.KeyCode.U, Enum.KeyCode.A, Enum.KeyCode.H, Enum.KeyCode.S, Enum.KeyCode.J, Enum.KeyCode.D, Enum.KeyCode.K, Enum.KeyCode.E, Enum.KeyCode.I, Enum.KeyCode.Q, Enum.KeyCode.Y, Enum.KeyCode.Up, Enum.KeyCode.Down)
			v_u_10:BindActionAtPriority("FreecamMousePan", v_u_76, false, v_u_19, Enum.UserInputType.MouseMovement)
			v_u_10:BindActionAtPriority("FreecamMouseWheel", v_u_82, false, v_u_19, Enum.UserInputType.MouseWheel)
			v_u_10:BindActionAtPriority("FreecamGamepadButton", v_u_73, false, v_u_19, Enum.KeyCode.ButtonX, Enum.KeyCode.ButtonY)
			v_u_10:BindActionAtPriority("FreecamGamepadTrigger", v_u_80, false, v_u_19, Enum.KeyCode.ButtonR2, Enum.KeyCode.ButtonL2)
			v_u_10:BindActionAtPriority("FreecamGamepadThumbstick", v_u_78, false, v_u_19, Enum.KeyCode.Thumbstick1, Enum.KeyCode.Thumbstick2)
			local touchMovedConn = v_u_14.TouchMoved:Connect(function(p84)
				local v85 = p84.Delta
				v_u_49.Delta = Vector2.new(-v85.Y, -v85.X)
			end)
			v_u_83 = touchMovedConn
			table.insert(connections, touchMovedConn)
		end
		function v_u_44.StopCapture()
			if v_u_83 then
				v_u_83:Disconnect()
				v_u_83 = nil
			end
			v_u_52 = 1
			local v86 = v_u_47; for v87, v88 in pairs(v86) do v86[v87] = v88 * 0 end
			local v89 = v_u_48; for v90, v91 in pairs(v89) do v89[v90] = v91 * 0 end
			local v92 = v_u_49; for v93, v94 in pairs(v92) do v92[v93] = v94 * 0 end
			v_u_10:UnbindAction("FreecamKeyboard"); v_u_10:UnbindAction("FreecamMousePan"); v_u_10:UnbindAction("FreecamMouseWheel")
			v_u_10:UnbindAction("FreecamGamepadButton"); v_u_10:UnbindAction("FreecamGamepadTrigger"); v_u_10:UnbindAction("FreecamGamepadThumbstick")
		end
		local function v_u_112(p95)
			local v96 = v_u_17.ViewportSize
			local v97 = v_u_9(v_u_40 / 2) * 2
			local v98 = v96.x / v96.y * v97
			local v99 = p95.rightVector;
			local v100 = p95.upVector; 
			local v101 = p95.lookVector
			local v102 = Vector3.new();
			local v103 = 512
			for v104 = 0, 1, 0.5 do
				for v105 = 0, 1, 0.5 do
					local v106 = (v104 - 0.5) * v98;
					local v107 = (v105 - 0.5) * v97
					local v108 = v99 * v106 - v100 * v107 + v101;
					local v109 = p95.p + v108 * 0.1
					local _, v110 = v_u_15:FindPartOnRay(Ray.new(v109, v108.unit * v103))
					local v111 = (v110 - v109).magnitude
					if v111 < v103 then v102 = v108.unit; v103 = v111 end
				end
			end
			return v101:Dot(v102) * v103
		end
		local function v_u_119(p113)
			local v114 = v_u_41:Update(p113, v_u_44.Vel(p113)); local v115 = v_u_42:Update(p113, v_u_44.Pan(p113));
			local v116 = v_u_43:Update(p113, v_u_44.Fov(p113))
			local v117 = v_u_8(0.7002075382097097 / v_u_9((v_u_6(v_u_40 / 2))))
			v_u_40 = v_u_4(v_u_40 + v116 * 300 * (p113 / v117), 1, 120)
			v_u_39 = v_u_39 + v115 * v_u_20 * (p113 / v117)
			v_u_39 = Vector2.new(v_u_4(v_u_39.x, -1.5707963267948966, 1.5707963267948966), v_u_39.y % 6.283185307179586)
			local v118 = CFrame.new(v_u_38) * CFrame.fromOrientation(v_u_39.x, v_u_39.y, 0) * CFrame.new(v114 * Vector3.new(64, 64, 64) * p113)
			v_u_38 = v118.p
			v_u_17.CFrame = v118
			v_u_17.Focus = v118 * CFrame.new(0, 0, -v_u_112(v118))
			v_u_17.FieldOfView = v_u_40
		end
		local v_u_120 = {}
		local v_u_121, v_u_122, v_u_123, v_u_124, v_u_125, v_u_126 = nil, nil, nil, nil, nil, nil
		local v_u_127 = {}
		local v_u_128 = { Backpack = true, Chat = true, Health = true, PlayerList = true }
		local v_u_129 = { BadgesNotificationsActive = true, PointsNotificationsActive = true }
		function v_u_120.Push()
			for v130 in pairs(v_u_128) do v_u_128[v130] = v_u_13:GetCoreGuiEnabled(Enum.CoreGuiType[v130]); v_u_13:SetCoreGuiEnabled(Enum.CoreGuiType[v130], false) end
			for v131 in pairs(v_u_129) do v_u_129[v131] = v_u_13:GetCore(v131); v_u_13:SetCore(v131, false) end
			local v132 = v_u_16:FindFirstChildOfClass("PlayerGui")
			if v132 then
				for _, v133 in pairs(v132:GetChildren()) do
					if v133:IsA("ScreenGui") and v133.Enabled and v133.Name ~= "TeleportControlGui" then v_u_127[#v_u_127 + 1] = v133; v133.Enabled = false end
				end
			end
			v_u_126 = v_u_17.FieldOfView; v_u_17.FieldOfView = 70; v_u_123 = v_u_17.CameraType; v_u_17.CameraType = Enum.CameraType.Custom
			v_u_125 = v_u_17.CFrame; v_u_124 = v_u_17.Focus; v_u_122 = v_u_14.MouseIconEnabled; v_u_14.MouseIconEnabled = false
			v_u_121 = v_u_14.MouseBehavior; v_u_14.MouseBehavior = Enum.MouseBehavior.Default
		end
		function v_u_120.Pop()
			for v134, v135 in pairs(v_u_128) do v_u_13:SetCoreGuiEnabled(Enum.CoreGuiType[v134], v135) end
			for v136, v137 in pairs(v_u_129) do v_u_13:SetCore(v136, v137) end
			for _, v138 in pairs(v_u_127) do if v138 and v138.Parent then v138.Enabled = true end end
			v_u_17.FieldOfView = v_u_126; v_u_126 = nil; v_u_17.CameraType = v_u_123; v_u_123 = nil; v_u_17.CFrame = v_u_125; v_u_125 = nil
			v_u_17.Focus = v_u_124; v_u_124 = nil; v_u_14.MouseIconEnabled = v_u_122; v_u_122 = nil; v_u_14.MouseBehavior = v_u_121; v_u_121 = nil
		end
		local function v_u_140()
			local v139 = v_u_17.CFrame
			v_u_39 = Vector2.new(v139:toEulerAnglesYXZ()); v_u_38 = v139.p; v_u_40 = v_u_17.FieldOfView
			v_u_41:Reset((Vector3.new())); v_u_42:Reset(Vector2.new()); v_u_43:Reset(0)
			v_u_120.Push()
			v_u_12:BindToRenderStep("Freecam", Enum.RenderPriority.Camera.Value, v_u_119)
			v_u_44.StartCapture()
		end
		local v_u_141 = false
		function v1.ToggleFreecam()
			if v_u_141 then
				v_u_44.StopCapture()
				v_u_12:UnbindFromRenderStep("Freecam")
				v_u_120.Pop()
			else
				v_u_140()
			end
			v_u_141 = not v_u_141
		end
		return v1
	end)()

	--================================--
	-- INPUT & JUMP LOGIC         --
	--================================--
	
	toggleFreecam = function() -- [MODIFIKASI] Diubah dari local function
		stopSpectating()
		stopFly() -- [MODIFIKASI FLY] Matikan fly jika freecam
		freecamEnabled = not freecamEnabled
		FreecamModule.ToggleFreecam()
		MainFrame.Visible = not freecamEnabled
	end

	table.insert(connections, UserInputService.InputBegan:Connect(function(input, gameProcessedEvent)
		local isShiftPressed = UserInputService:IsKeyDown(Enum.KeyCode.LeftShift) or UserInputService:IsKeyDown(Enum.KeyCode.RightShift)
		
		-- [MODIFIKASI FLY] Jangan proses input jika fly aktif dan *bukan* tombol GUI/Keybind
		if flyEnabled then
			if input.KeyCode == Enum.KeyCode.Home then
				toggleGUIVisibility()
			elseif input.KeyCode == Enum.KeyCode.V then -- [MODIFIKASI KEYBIND] Tambahkan V
				toggleFly()
			end
			-- Input lain (W,A,S,D,Q,E) sudah ditangani oleh listener flyKeyDown
			return
		end
		
		if freecamEnabled then
			if input.KeyCode == Enum.KeyCode.P and isShiftPressed then
				toggleFreecam()
			end
			return
		end
		
		-- [MODIFIKASI KEYBIND] Hapus V dari cek isSpectating agar V tetap bisa mematikan spectate
		if isSpectating and not (input.KeyCode == Enum.KeyCode.Home or (input.KeyCode == Enum.KeyCode.P and isShiftPressed) or input.KeyCode == Enum.KeyCode.V) then
			return
		end
		
		if gameProcessedEvent then
			-- [MODIFIKASI KEYBIND] Tambahkan V ke pengecualian gameProcessedEvent
			if input.KeyCode == Enum.KeyCode.Home or (input.KeyCode == Enum.KeyCode.P and isShiftPressed) or input.KeyCode == Enum.KeyCode.V then
				-- Izinkan tombol-tombol ini lolos
			else
				return
			end
		end

		if input.KeyCode == Enum.KeyCode.Home then
			toggleGUIVisibility()
		elseif input.KeyCode == Enum.KeyCode.P and isShiftPressed then
			toggleFreecam()
		elseif input.KeyCode == Enum.KeyCode.V then -- [MODIFIKASI KEYBIND] Tambahkan V
			toggleFly()
		end
	end))

	--================--
	-- INITIALIZATION --
	--================--
	Workspace.Gravity = currentGravity -- [MODIFIKASI] Set gravitasi saat skrip dimuat
	updatePlayerList()
	if player.Character then
		onCharacterAdded(player.Character)
	end

	--======================================--
	-- [PEMBERSIHAN] PEMBUATAN HANDLE GLOBAL --
	--======================================--
	local handle = {}
	handle.gui = ScreenGui
	handle.connections = connections
	handle.freecamModule = FreecamModule

	function handle:cleanup()
		print("Membersihkan instance skrip teleport sebelumnya...")
		
		stopSpectating() 
		stopESP() -- [MODIFIKASI ESP] Panggil fungsi stopESP
		stopFly() -- [MODIFIKASI FLY] Panggil fungsi stopFly
		
		if freecamEnabled then
			self.freecamModule.ToggleFreecam()
		end
		
		-- [MODIFIKASI] Reset gravitasi, walkspeed, dan jump power
		Workspace.Gravity = DEFAULT_GRAVITY
		if player.Character and player.Character:FindFirstChildOfClass("Humanoid") then
			player.Character.Humanoid.WalkSpeed = DEFAULT_WALKSPEED
			player.Character.Humanoid.JumpPower = DEFAULT_JUMPPOWER
		end
		
		for _, conn in ipairs(self.connections) do
			conn:Disconnect()
		end

		-- [MODIFIKASI ESP] Hapus holder GUI ESP
		if espHolder and espHolder.Parent then
			espHolder:Destroy()
		end
		
		if self.gui and self.gui.Parent then
			self.gui:Destroy()
		end
		
		_G.YoguruttoTeleportScriptHandle = nil
	end

	_G.YoguruttoTeleportScriptHandle = handle
		
	if loaderGuiToDestroy and loaderGuiToDestroy.Parent then
		print("Modul aktif, menghancurkan loader...")
		loaderGuiToDestroy:Destroy()
	end
end
